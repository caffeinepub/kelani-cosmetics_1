{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 3,
  "summary": "Standardize public product image display using object-contain and fix search-to-modal product image rendering by returning binary photo data from backend search and generating/cleaning up blob URLs on the frontend (no images in search dropdown, max 10 results, Spanish UI, no index.css modifications).",
  "architectural_notes": [
    "Product photos are stored/transported as binary; frontend must create blob URLs for display (no direct URL fields).",
    "Search dropdown must remain lightweight: render text-only items and avoid image fetching/conversion there.",
    "Blob URL lifecycle must be managed (revoke on modal close and/or when new search results load) to prevent memory leaks.",
    "Backend search results must be limited to 10 items for bandwidth/performance.",
    "Maintain Spanish interface; do not modify existing index.css styles (only add new styles if absolutely necessary)."
  ],
  "known_issues": [
    "Product details modal opened from search results does not display product image due to missing blob URL generation / incorrect search response photo field."
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "feature-standardize-product-image-rendering-across-all-public-facing-ui-by-applying-tailwind-object-contain-to-every-img-that-displays-a-product-photo-including-fallback-default-images-while-preserving-all-other-existing-classes-and-layout-behavior",
      "title": "Standardize product image rendering across all public-facing UI by applying Tailwind `object-contain` to every <img> that displays a product photo (including fallback/default images), while preserving all other existing classes and layout behavior.",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-the-homepage-autocomplete-dropdown-remains-text-only-do-not-render-product-images-do-not-create-blob-urls-and-do-not-attempt-any-binary-to-image-conversion-inside-dropdown-item-components-dropdown-items-must-show-only-product-name-category-name-and-formatted-price-with-sale-formatting-if-applicable",
      "title": "Ensure the homepage autocomplete dropdown remains text-only: do not render product images, do not create blob URLs, and do not attempt any binary-to-image conversion inside dropdown item components; dropdown items must show only product name, category name, and formatted price (with sale formatting if applicable).",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-product-details-modal-image-rendering-when-opened-from-homepage-search-results-by-generating-a-blob-url-from-the-binary-photo-data-on-search-result-selection-click-keyboard-select-attaching-the-blob-url-to-the-modal-bound-product-object-or-storing-it-alongside-modal-state-and-updating-the-modal-to-prefer-the-blob-url-when-present-and-otherwise-fall-back-to-the-default-image-the-modal-must-not-make-any-additional-api-calls-to-fetch-photos",
      "title": "Fix the product details modal image rendering when opened from homepage search results by generating a blob URL from the binary `photo` data on search-result selection (click/keyboard select), attaching the blob URL to the modal-bound product object (or storing it alongside modal state), and updating the modal to prefer the blob URL when present and otherwise fall back to the default image; the modal must not make any additional API calls to fetch photos.",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-blob-url-lifecycle-management-for-blob-urls-created-from-binary-product-photos-in-the-public-ui-including-the-search-result-to-modal-flow-track-created-blob-urls-and-revoke-them-when-no-longer-needed-e-g-when-the-modal-closes-and-or-when-the-active-modal-product-changes-to-prevent-memory-leaks-do-not-revoke-blob-urls-while-they-are-still-in-use-by-a-visible-image-element",
      "title": "Implement blob URL lifecycle management for blob URLs created from binary product photos in the public UI (including the search-result-to-modal flow): track created blob URLs and revoke them when no longer needed (e.g., when the modal closes and/or when the active modal product changes) to prevent memory leaks; do not revoke blob URLs while they are still in use by a visible image element.",
      "reqIds": [
        "REQ-5"
      ],
      "version": 1
    },
    {
      "id": "feature-maintain-existing-behavior-for-opening-the-product-details-modal-from-non-search-entry-points-e-g-clicking-product-cards-on-homepage-category-grids-while-aligning-all-public-product-image-sources-to-the-same-data-flow-pattern-binary-photo-data-blob-url-image-display-with-correct-fallback-handling",
      "title": "Maintain existing behavior for opening the product details modal from non-search entry points (e.g., clicking product cards on homepage/category grids) while aligning all public product image sources to the same data flow pattern: binary photo data → blob URL → image display, with correct fallback handling.",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Apply `object-contain` to all public-facing product images (cards, pages, modal, fallbacks) for consistent non-cropped display",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Fix backend `searchHomepageProducts` to return binary photo data (not URL fields) while keeping max 10 results and required product fields",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Ensure search dropdown items are text-only (name/category/price) with no product images or photo processing",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-4",
      "summary": "Fix search-result click → product details modal to generate blob URLs from binary photo data, prefer blob URL in modal, and revoke URLs to prevent leaks",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-6",
      "summary": "Fix the backend `searchHomepageProducts` function to return complete product data including the binary `photo` field (stored as `?[Nat8]`) for each search result, and remove any attempt to return/construct a product image URL string. Keep the maximum result limit at 10 and preserve all other fields needed for UI display (e.g., name, barcode, category name/id, pricing, and sale fields if currently included).",
      "reqIds": [
        "REQ-2"
      ],
      "status": "pending"
    }
  ],
  "projectName": "Standardize public product images with object-contain and fix search-to-modal image blob URL flow",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}