{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 3,
  "summary": "Refactor Motoko backend product-fetching functions to consistently include sale information and update frontend displays accordingly.",
  "architectural_notes": [
    "Introduce a shared Motoko helper to compute active sale status and attach salePrice/discountPercentage to product responses; avoid repeated loops and preserve existing pagination/sorting logic."
  ],
  "known_issues": [],
  "isFixRequest": false,
  "existing_features": [
    {
      "id": "feature-update-frontend-data-fetching-mapping-code-that-calls-getproductspagefeaturedfirst-gethomepagecategories-and-getproduct-so-it-uses-the-backend-provided-sale-fields-instead-of-defaulting-sale-fields-to-undefined-false-and-ensure-the-ui-displays-the-sale-price-when-present-otherwise-it-displays-the-normal-price",
      "title": "Update frontend data fetching/mapping code that calls `getProductsPageFeaturedFirst`, `getHomepageCategories`, and `getProduct` so it uses the backend-provided sale fields (instead of defaulting sale fields to undefined/false), and ensure the UI displays the sale price when present; otherwise it displays the normal price.",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Refactor Motoko backend: getProductsPageFeaturedFirst/getHomepageCategories/getProduct must return products with salePrice, discountPercentage, and sale active status using a shared helper; update frontend pages to display sale price when present while preserving pagination/sorting.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Refactor the Motoko backend so that `getProductsPageFeaturedFirst`, `getHomepageCategories`, and `getProduct` consistently return products including sale information: `salePrice`, `discountPercentage`, and a boolean indicating whether the sale is active, while always including the product `price`.",
      "reqIds": [
        "REQ-1"
      ],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Implement a single shared Motoko helper that determines whether a product currently has an active sale using the existing sale rules, and attaches sale fields to the returned product data without changing the underlying stored data model.",
      "reqIds": [
        "REQ-2"
      ],
      "status": "pending"
    },
    {
      "id": "AR-4",
      "summary": "Preserve the existing pagination and sorting behavior of `getProductsPageFeaturedFirst` and `getHomepageCategories` while adding sale info, and follow Motoko best practices by using `map`/functional transformations and avoiding repeated loops where possible.",
      "reqIds": [
        "REQ-3"
      ],
      "status": "pending"
    }
  ],
  "projectName": "Refactor backend product fetches to consistently return sale info and update frontend to display sale price",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}