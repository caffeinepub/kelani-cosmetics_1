{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 3,
  "summary": "Motoko backend refactor to permanently make specific read/public endpoints accessible without user authentication (remove all checkUser(caller) calls from those functions) while keeping admin checks intact; no frontend changes and preserve the :root CSS variables block in index.css.",
  "architectural_notes": [
    "Backend policy: specified read/public functions (e.g., getBothStoreDetails, getAllCategories, getProduct, getProductPhoto, getTotalProductCount, getFeaturedProducts, getActiveSales, getHomepageCategories, getCategoryProductCounts, getProductsPageFeaturedFirst, searchHomepageProducts) must never perform authentication/permission checks or call checkUser (or similar); admin-only checks via checkAdmin remain allowed where applicable.",
    "Frontend/CSS constraint: never modify or overwrite the existing :root CSS custom properties block in index.css; only append additional styles below it."
  ],
  "known_issues": [],
  "isFixRequest": false,
  "existing_features": [],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Permanently remove checkUser(caller) from specified public backend functions so they are accessible without authentication; keep checkAdmin(caller) intact.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Enforce rule: never add authentication/permission checks (including checkUser or similar) back into the specified permanently-public functions in future code changes.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Preserve the exact :root CSS custom properties block in index.css (theme variables); only append new CSS below without modifying that block.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-4",
      "summary": "In `backend/main.mo`, remove all invocations of `checkUser(caller)` from the actor codebase so that the affected endpoints no longer require any authenticated-user permission check. This includes, at minimum, removing the `checkUser(caller);` statement from the following query functions: `getAllCategories` (currently calls `checkUser`), `getCategoryById` (currently calls `checkUser`), `getProductPhoto` (currently calls `checkUser`), `getTotalProductCount` (currently calls `checkUser`), `getFeaturedProducts` (currently calls `checkUser`), and `getActiveSales` (currently calls `checkUser`). Also remove `checkUser(caller)` calls from any other functions present in the file (even if not listed here) so that there are zero call sites remaining.",
      "reqIds": [
        "REQ-1"
      ],
      "status": "pending"
    },
    {
      "id": "AR-5",
      "summary": "Ensure the following backend functions are permanently public and contain no authentication, permission, or user-identity gating logic of any kind (including but not limited to `checkUser`, `AccessControl.hasPermission(... #user)`, or any similar checks), while preserving existing `checkAdmin(caller)` enforcement wherever it currently applies: `getBothStoreDetails`, `getAllCategories`, `getProduct`, `getProductPhoto`, `getTotalProductCount`, `getFeaturedProducts`, `getActiveSales`, `getHomepageCategories`, `getCategoryProductCounts`, `getProductsPageFeaturedFirst`, `searchHomepageProducts`. If any of these functions currently perform a user-permission check via something other than `checkUser`, remove that user-permission check as well. Do not change the functionsâ€™ non-auth logic or response shapes.",
      "reqIds": [
        "REQ-2"
      ],
      "status": "pending"
    },
    {
      "id": "AR-6",
      "summary": "Add an explicit, durable in-code guardrail comment in `backend/main.mo` immediately above each of the permanently-public functions listed in REQ-2 stating that the function is permanently public and must never add authentication/permission checks (including `checkUser` or similar) in future changes. The comment must be clear and unambiguous and must not alter runtime behavior.",
      "reqIds": [
        "REQ-3"
      ],
      "status": "pending"
    }
  ],
  "gameProjectType": "none",
  "projectName": "Make specified backend read endpoints permanently public (remove checkUser calls)",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}