{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 5,
  "summary": "Frontend: update home page mobile UI and category loading behavior — remove mobile header 'Contacto' link (keep in side panel), switch infinite scroll to scroll-triggered batch loading (5 categories when within 500px of bottom) with Spanish loading/end messages, and reduce mobile banner height by 20% via responsive CSS while preserving existing desktop behavior.",
  "architectural_notes": [
    "Do not modify the :root CSS custom properties block in index.css (theme variables). Append any new CSS only below the block without changing names/values/structure.",
    "Batch import must be atomic (all-or-nothing) and must preserve imported nanosecond timestamps exactly as provided (map directly to Motoko Int, no overwrites)."
  ],
  "known_issues": [],
  "isFixRequest": false,
  "existing_features": [
    {
      "id": "feature-update-the-public-header-so-that-the-contacto-navigation-link-is-hidden-on-mobile-screens-while-remaining-visible-on-desktop-and-ensure-the-contacto-link-remains-available-in-the-left-side-panel-navigation",
      "title": "Update the public header so that the \"Contacto\" navigation link is hidden on mobile screens while remaining visible on desktop, and ensure the \"Contacto\" link remains available in the left side panel navigation.",
      "reqIds": [
        "REQ-8"
      ],
      "version": 1
    },
    {
      "id": "feature-replace-the-current-intersectionobserver-based-automatic-infinite-scroll-on-the-home-page-categories-list-with-a-throttled-window-scroll-listener-that-triggers-loading-only-when-the-user-scrolls-within-500px-of-the-bottom-of-the-page",
      "title": "Replace the current IntersectionObserver-based automatic infinite scroll on the home page categories list with a throttled window scroll listener that triggers loading only when the user scrolls within 500px of the bottom of the page.",
      "reqIds": [
        "REQ-9"
      ],
      "version": 1
    },
    {
      "id": "feature-change-home-page-category-pagination-so-that-each-scroll-trigger-loads-and-appends-exactly-5-additional-categories-including-their-associated-products-per-existing-implementation-preserving-the-existing-ordering-by-the-category-order-field-and-never-replacing-resetting-categories-already-rendered",
      "title": "Change home page category pagination so that each scroll trigger loads and appends exactly 5 additional categories (including their associated products per existing implementation), preserving the existing ordering by the category order field and never replacing/resetting categories already rendered.",
      "reqIds": [
        "REQ-10"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-and-display-home-page-category-loading-states-beneath-the-last-loaded-category-show-a-centered-spinner-with-the-exact-spanish-text-cargando-m-s-categor-as-during-incremental-fetches-and-when-all-categories-are-loaded-replace-it-with-the-persistent-spanish-message-no-hay-m-s-categor-as-para-mostrar-until-the-user-leaves-the-page",
      "title": "Implement and display home page category loading states beneath the last loaded category: show a centered spinner with the exact Spanish text \"Cargando más categorías...\" during incremental fetches, and when all categories are loaded replace it with the persistent Spanish message \"No hay más categorías para mostrar\" until the user leaves the page.",
      "reqIds": [
        "REQ-11"
      ],
      "version": 1
    },
    {
      "id": "feature-reduce-the-home-page-banner-height-by-20-on-mobile-screens-only-keeping-the-desktop-banner-height-unchanged-using-responsive-css-media-queries-added-to-frontend-src-index-css-without-modifying-the-existing-root-css-variables-block",
      "title": "Reduce the home page banner height by 20% on mobile screens only, keeping the desktop banner height unchanged, using responsive CSS media queries added to frontend/src/index.css without modifying the existing :root CSS variables block.",
      "reqIds": [
        "REQ-12"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Fix/simplify backend batchImportData: preserve imported timestamps, upsert categories by categoryId and products by barcode, process categories then products atomically, update lastCategoryId to max, and return Spanish error messages",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Update the Motoko backend method `batchImportData` (in `backend/main.mo`) to preserve imported timestamps exactly as provided: map imported `createdDate`/`lastUpdatedDate` values directly to Motoko `Int` and never replace them with `Time.now()` or any generated timestamp during import.",
      "reqIds": [
        "REQ-1"
      ],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Simplify category import logic inside `batchImportData` to use `categoryId` as the unique identifier and perform an upsert: if `categories` already contains the `categoryId`, overwrite/update all fields with the imported category record; otherwise insert it as a new entry. Preserve imported timestamps in both cases.",
      "reqIds": [
        "REQ-2"
      ],
      "status": "pending"
    },
    {
      "id": "AR-4",
      "summary": "Within `batchImportData`, track the maximum `categoryId` across BOTH existing stored categories and imported categories, and set `lastCategoryId` to that maximum value after all categories are successfully processed.",
      "reqIds": [
        "REQ-3"
      ],
      "status": "pending"
    },
    {
      "id": "AR-5",
      "summary": "Simplify product import logic inside `batchImportData` to use `barcode` as the unique identifier and perform an upsert: if `products` already contains the barcode, overwrite/update all fields with the imported product record; otherwise insert it as a new entry. Preserve imported timestamps in both cases.",
      "reqIds": [
        "REQ-4"
      ],
      "status": "pending"
    },
    {
      "id": "AR-6",
      "summary": "Refactor `batchImportData` code to be straightforward and single-pass: avoid unnecessary cloning of the category/product maps, avoid multi-pass validation, and rely on the natural unique keys (`categoryId`, `barcode`) for duplicate prevention; use Motoko `Map` operations that naturally handle existence checks (e.g., `get` + `add`, or equivalent) during the upsert flow.",
      "reqIds": [
        "REQ-5"
      ],
      "status": "pending"
    },
    {
      "id": "AR-7",
      "summary": "Ensure `batchImportData` import transaction behavior is atomic and ordered: (1) process and apply categories first, (2) then process and apply products. If any error occurs (including referential integrity issues), the import must result in no persisted changes (all-or-nothing).",
      "reqIds": [
        "REQ-6"
      ],
      "status": "pending"
    },
    {
      "id": "AR-8",
      "summary": "Update `batchImportData` error reporting so that failures produce clear Spanish error messages intended for frontend display, preferably via the existing `ImportResult.errorMessages` array and/or trapped error text where applicable. Messages must be specific enough to help the user fix the import file.",
      "reqIds": [
        "REQ-7"
      ],
      "status": "pending"
    },
    {
      "id": "AR-9",
      "summary": "Home page mobile header: remove 'Contacto' link from the mobile header (keep it in the left side panel nav), leaving only hamburger menu + logo; desktop header unchanged.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-10",
      "summary": "Home page category loading: replace automatic infinite scroll with scroll-triggered loading—when within 500px of page bottom, fetch and append 5 more categories (with products) below existing ones; preserve product display logic and category ordering by existing 'order' field; do not reset/replace existing categories.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-11",
      "summary": "Home page loading states/messages: show centered loading indicator below last category with Spanish text 'Cargando más categorías...' while fetching; when all categories are loaded, replace indicator with persistent Spanish message 'No hay más categorías para mostrar' until user leaves page.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-12",
      "summary": "Mobile-only banner height: reduce home page banner height by 20% on mobile screens via responsive CSS media queries (append CSS below existing :root variables block in index.css); ensure banner content scales/readability; desktop unchanged.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-13",
      "summary": "Scroll trigger implementation: add throttled scroll event listener, dynamically compute distance to bottom, and trigger loading only when user actively scrolls within 500px threshold; optimize for mobile touch scrolling performance and maintain Spanish UI.",
      "reqIds": [],
      "status": "pending"
    }
  ],
  "gameProjectType": "none",
  "projectName": "Fix Motoko batchImportData upsert logic with timestamp preservation and atomic import",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}