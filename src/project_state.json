{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 3,
  "summary": "Admin dashboard feature: add an /admin/import page to restore categories and products from exported JSON via a single atomic batch import API, with Spanish UI and BigInt-safe JSON handling.",
  "architectural_notes": [
    "Do not remove/modify/overwrite the :root CSS custom properties block in index.css (theme color variables); only append new styles below it.",
    "Import JSON must be parsed with BigInt support (parseJSONWithBigInt) to handle exportTimestamp and preserve format compatibility with the Export page.",
    "Import must be executed as a single HTTP request and transactional/atomic (all-or-nothing rollback) while importing categories first then products."
  ],
  "known_issues": [],
  "isFixRequest": false,
  "existing_features": [
    {
      "id": "feature-create-a-new-admin-only-page-at-route-admin-import-for-importing-categories-and-products-from-a-json-file-previously-exported-by-the-existing-export-page-using-the-exact-importdata-structure-categories-products-exporttimestamp-itemcounts",
      "title": "Create a new admin-only page at route `/admin/import` for importing categories and products from a JSON file previously exported by the existing Export page, using the exact ImportData structure (categories, products, exportTimestamp, itemCounts).",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-add-navigation-entries-to-reach-admin-import-from-a-the-admin-sidebar-left-panel-and-b-the-admin-dashboard-cards-place-the-import-link-card-after-export",
      "title": "Add navigation entries to reach `/admin/import` from (a) the admin sidebar left panel and (b) the admin dashboard cards; place the Import link/card after Export.",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-the-import-page-ui-sections-1-import-information-section-showing-filename-counts-export-date-and-validation-status-after-file-selection-2-drag-and-drop-click-to-select-upload-area-that-only-accepts-json-files-3-clear-cancel-button-to-remove-the-selected-file-and-to-stop-an-in-progress-import-request",
      "title": "Implement the Import page UI sections: (1) Import Information section showing filename, counts, export date, and validation status after file selection; (2) Drag-and-drop + click-to-select upload area that only accepts `.json` files; (3) Clear/cancel button to remove the selected file and to stop an in-progress import request.",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-the-required-client-side-flow-file-selection-read-with-filereader-parse-using-parsejsonwithbigint-validate-structure-and-field-types-including-numeric-validation-conversion-if-valid-automatically-trigger-the-backend-import-call-without-an-extra-button-click-display-simple-progress-states-no-real-time-per-item-progress",
      "title": "Implement the required client-side flow: file selection → read with FileReader → parse using `parseJSONWithBigInt()` → validate structure and field types (including numeric validation/conversion) → if valid, automatically trigger the backend import call without an extra button click → display simple progress states (no real-time per-item progress).",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-use-the-shared-api-utilities-for-the-import-request-call-the-backend-batch-import-method-via-the-actor-and-handle-errors-using-the-standardized-apiresponsehandler-patterns-display-spanish-error-messages-and-a-spanish-success-toast-summarizing-imported-updated-counts",
      "title": "Use the shared API utilities for the import request: call the backend batch import method via the actor and handle errors using the standardized `ApiResponseHandler` patterns; display Spanish error messages and a Spanish success toast summarizing imported/updated counts.",
      "reqIds": [
        "REQ-5"
      ],
      "version": 1
    },
    {
      "id": "feature-after-import-completion-display-an-import-results-section-with-counts-for-categories-imported-updated-products-imported-updated-and-error-count-if-any-include-post-import-action-links-to-the-categories-and-products-admin-pages-include-a-button-to-clear-reset-the-import-interface-for-the-next-file",
      "title": "After import completion, display an Import Results section with: counts for categories imported/updated, products imported/updated, and error count (if any); include post-import action links to the Categories and Products admin pages; include a button to clear/reset the import interface for the next file.",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Implement /admin/import page (admin-only) to import categories/products from exported JSON with client-side validation and auto-start import flow; show Spanish UI, progress states, results, and post-import links.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Add backend batchImportData(importData) endpoint to process a single-request atomic batch import: upsert categories then products (match by barcode), preserve existing photoUrl when imported photoUrl is empty, ensure category-product consistency, and update lastCategoryId = maxImportedCategoryId + 1.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Use shared utilities for import: parseJSONWithBigInt/stringifyWithBigInt for BigInt timestamps, numeric validation/conversion, standardized ApiResponseHandler, Spanish error messaging, and graceful handling of large JSON files.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-10",
      "summary": "Add a new backend actor method `batchImportData(importData: ImportData) : async ImportResult` that processes the full import in a single request, upserting categories first and then products, and returns counts plus any errors.",
      "reqIds": [
        "REQ-7"
      ],
      "status": "pending"
    },
    {
      "id": "AR-11",
      "summary": "Implement transactional/atomic import semantics in `batchImportData`: if any validation or consistency check fails, do not persist partial changes (rollback behavior) and return an ImportResult indicating failure/errors.",
      "reqIds": [
        "REQ-8"
      ],
      "status": "pending"
    },
    {
      "id": "AR-12",
      "summary": "Implement category ID counter management in the backend: after importing categories, ensure `lastCategoryId` is updated so that future category creation cannot conflict with imported IDs; set it to at least (max imported categoryId + 1) without decreasing it if it is already higher.",
      "reqIds": [
        "REQ-9"
      ],
      "status": "pending"
    },
    {
      "id": "AR-13",
      "summary": "Implement product import behavior in the backend: match products by `barcode`; if a product exists, update its fields; if not, create it. Preserve existing product photo/image data when the imported product has an empty/missing photo field during an update.",
      "reqIds": [
        "REQ-10"
      ],
      "status": "pending"
    },
    {
      "id": "AR-14",
      "summary": "Ensure backend data consistency for category-product references during import: products must only reference valid category IDs after the categories upsert step; reject/abort the import if references are invalid.",
      "reqIds": [
        "REQ-11"
      ],
      "status": "pending"
    }
  ],
  "projectName": "Add Admin Import page with single-request atomic batch import for categories and products",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}